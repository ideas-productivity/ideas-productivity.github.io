<div class="list-events">

	<!-- Paginated Event Listing
	adapted from: https://blog.rafael.picanco.nom.br/2015/09/06/jekyll-pagination-on-github-pages-without-plugins.html 
	-->

	<!-- Query the events -->
	{% assign today = site.time | date:"%Y-%m-%d" %}

{% comment %}
Interpreting dates

s = startdate, e = enddate, t = today
situation			result		inequalities	enddate absent
s--e t				past		s < t, e < t	s < t
t s--e				upcoming	s >= t, e >= t	s >=t
s-t-e (in progress)	upcoming	s < t, e >= t	impossible

An event can be considered to be past iff both startdate and enddate are in the past. If there is an endate we have to check it to be certain the event is not in progress (which we interpret as upcoming because there are still some dates upcoming).
{% endcomment %}

	{% if include.past %}
		{% assign enddate = site.events | where_exp: "item", "item.startdate < today and item.enddate < today" %}
		{% assign noenddate = site.events | where_exp: "item", "item.enddate == nil and item.startdate < today" %}
		{% assign sorted = enddate | concat: noenddate | sort:"startdate" | reverse %}
	{% else %}
		{% assign sorted = site.events | where_exp: "item", "item.startdate >= today or item.enddate >= today" | sort:"startdate"  %}
	{% endif %}

	<!-- List Markup -->
	<div class="eventlist-wrapper" id="js-upcoming-events">

		{% if include.title %}
			<div class="list-title">
				<h1 class="list-title">{{ include.title }}</h1>
				<hr>
			</div>
		{% endif %}

		{% if sorted and sorted.size != 0 %}
		<ul class="list">
			{% for event in sorted %}
				{% unless event.subevent %}
				{% if event.link-id %}
				<li id="{{ event.link-id }}">
				{% else %}
				<li>	
				{% endif %}	
						<a href="{{ event.url }}" class="event-link">
						  <h2 class="event-title">{{ event.title }}</h2>
						  <p class="event-date">
						  	{{ event.startdate | date:"%b %d" }}
							  {% assign startmo = event.startdate | date:"%b"  %}
							  {% assign endmo = event.enddate | date:"%b"  %}
							  {% if event.enddate %}
							  	{% if startmo == endmo %}
							  		â€“{{ event.enddate | date:"%d" }}
							  	{% else %}
							  		â€“{{ event.enddate | date:"%b %d" }}
							  	{% endif %}
							  {% endif %}
							</p>
							<small class="event-year">
								{{ event.startdate | date:"%Y" }}
							</small>
							<small class="event-type">
								{{ event.type }}
							</small>
						</a>
						{% if event.series %}
							{% assign length = event.series | size %}
					  	<small class="event-series">Series: 
							  {{ event.series | join: ", " }}
					  	</small> 
					  {% endif %}

					  {% if event.subevents %}
					  	<ul class="subevents">
						  	{% for subslug in event.subevents %}
						  	{% assign sub = site.events | where: 'slug', subslug %}
						  		<li>
						  			<a href="{{ sub[0].url }}" class="subevent-link">
						  				<h3 class="subevent-title">
							  				{{ sub[0].title }}
							  			</h3>
							  			<p class="subevent-time">
							  				{{ sub[0].time }}
							  			</p>
							  			<small class="subevent-date">
							  				{{ sub[0].startdate | date:"%b %d" }}
							  			</small>
							  			<small class="subevent-type">
							  				{{ sub[0].type }}
							  			</small>
							  		</a>
							  			{% if sub[0].series %}
												{% assign sublength = sub[0].series | size %}
										  	<small class="subevent-series">Series: 
												{{ sub[0].series | join: ", " }}
										  	</small> 
										  {% endif %}
							  	</li>
						  	{% endfor %}
						  </ul>
					  {% endif %}
					</li>
				{% endunless %}
			{% endfor %}
		</ul>
		{% else %}
		<p>No events found</p>
		{% endif %}

		<div class="pagination-wrapper">
			<ul id="js-pagination" class="pagination"></ul>
		</div>
	</div>
</div>