<!-- 

UPCOMING EVENTS

-------------------------------------------------------------------------------

available parameters:
* title
* group-linktext
* group-linkurl
limit (default: 3)

* required

-------------------------------------------------------------------------------

-->

{% assign limit = include.limit | default: 3 %}

<div class="upcoming-events">


	<!-- Group Intro  -->
	<div class="group-intro">
			<h1>{{ include.title }}</h1>

			<a class="group-link" href="{{ include.group-linkurl }}">
				{{ include.group-linktext }}
			</a>	

			<hr>
	</div>	


	{% comment %}
		We're interested in upcoming events only, which is the first where_exp.

		Moreover, we're only interested in top-level events, since the listing of an event will include its subevents too.  Anything with the parent-event-* keys is a subevent of something else and will be listed that way.  That's the second where_exp.

		And the side benefit of excluding the subevents from the list is that we
		deal wit the limit on the number of upcoming events to list properly 
		because they're not in the array, confusing the count.
	{% endcomment %}
	{% assign today = site.time | date:"%Y-%m-%d" %}
	{% assign sorted = site.events | where_exp: "item", "item.startdate >= today or item.enddate >= today" | where_exp: "item", "item.parent-event-name == nil" and "item.parent-event-file == nil" | sort:"startdate"  %}

		{% if sorted and sorted.size != 0 %}
		<ul class="event-list">
		{% for event in sorted limit: limit %}
		{% unless event.subevent %}
		<li>	

		{% comment %}
			For most events, we take the title as-is from the frontmatter.  But tutorials are special.  
			They usually have a "title-type" that characterizes how the venue labels the event (e.g., tutorial or track or training or...).
			They also have venue information, which we will add to the title iff this is a standalone event (i.e., one that doesn't have
			parent-event information).
		{% endcomment %}

		{% if event.title-type %}
			{% assign my-title = event.title | append: " " | append: event.title-type %}
		{% else %}
			{% assign my-title = event.title %}
		{% endif %}

				<a href="{{ event.url }}" class="event-link">
				  <h2 class="event-title">{{ my-title }}</h2>
				  <p class="event-date">
					  {{ event.startdate | date:"%b %d" }}
					  {% assign startmo = event.startdate | date:"%b"  %}
					  {% assign endmo = event.enddate | date:"%b"  %}
					  {% if event.enddate %}
						  {% if startmo == endmo %}
							  â€“{{ event.enddate | date:"%d" }}
						  {% else %}
							  â€“{{ event.enddate | date:"%b %d" }}
						  {% endif %}
					  {% endif %}
					</p>
					<small class="event-year">
						{{ event.startdate | date:"%Y" }}
					</small>
					<small class="event-type">
						{{ event.type }}
					</small>
				</a>
				{% assign series = nil %}
					{% if event.series %}
						{% assign series = event.series | join: ", " %}
						{% assign series = series | prepend: "Series: " %}
					{% endif %}
					{% assign venue = nil %}
					{% if event.venue %}
						{% assign venue = "Venue: " | append: event.venue %}
					{% endif %}
					{% if series or venue %}
					  	<div class='event-series_venue'>
					  		<small class="event-series">{{ series }}</small>
					  		<small class='event-venue'>{{ venue }}</small>
					  	</div>
					{% endif %}

			  {% if event.subevents %}
				  <ul class="subevents">
					  {% for subslug in event.subevents %}
						{% assign subs = site.events | where: 'slug', subslug %}
						{% assign my-subevent = subs[0] %}
						{% include _events/subevent-item.html subevent=my-subevent %}
					  {% endfor %}
				  </ul>
			  {% endif %}
			</li>
		{% endunless %}
	{% endfor %}
	</ul>
	{% else %}
	<p>No events found</p>
	{% endif %}
	{% assign remaining = sorted | size | minus: limit %}
	{% if remaining > 0 %}
		<p class="upcoming-events--more"><a href='{{ include.group-linkurl }}'>see {{remaining }} more upcoming {{ remaining | pluralize: "event", "events" }}</a></p>
	{% endif %}

</div>